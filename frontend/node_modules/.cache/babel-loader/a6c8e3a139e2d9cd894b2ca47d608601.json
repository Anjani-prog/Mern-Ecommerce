{"ast":null,"code":"var _jsxFileName = \"/Users/anjanitharayil/Documents/Development/ecommerce/frontend/src/App.js\";\nimport React, { Component } from \"react\";\nimport { Switch, Route, Link, BrowserRouter as Router } from \"react-router-dom\";\nimport axios from 'axios';\nimport jwt_decode from 'jwt-decode';\nimport AddProduct from './components/AddProduct';\nimport Cart from './components/Cart';\nimport Login from './components/Login';\nimport ProductList from './components/ProductList';\nimport Register from './components/Register';\nimport Context from \"./Context\";\nimport Loader from \"react-loader-spinner\";\nexport default class App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.register = async (email, password) => {\n      this.setState({\n        visible: true\n      });\n      const res = await axios.post('http://localhost:5000/api/user/signup', {\n        username: email,\n        password: password\n      }).catch(res => {\n        this.setState({\n          visible: false\n        });\n        return {\n          status: 401,\n          message: 'Unauthorized'\n        };\n      });\n\n      if (res.status === 200) {\n        this.setState({\n          visible: false\n        });\n\n        if (res.data.status === true) {\n          alert(res.data.message);\n          this.routerRef.current.history.push(\"/login\");\n          return true;\n        } else {\n          alert(res.data.message);\n          return false;\n        }\n      } else {\n        this.setState({\n          visible: false\n        });\n        return false;\n      }\n    };\n\n    this.login = async (email, password) => {\n      this.setState({\n        visible: true\n      });\n      const res = await axios.post('http://localhost:5000/api/user/login', {\n        username: email,\n        password: password\n      }).catch(res => {\n        this.setState({\n          visible: false\n        });\n        return {\n          status: 401,\n          message: 'Unauthorized'\n        };\n      });\n\n      if (res.status === 200) {\n        if (res.data.status === true) {\n          // console.log(jwt_decode(res.data.data.token))\n          const {\n            username,\n            _id\n          } = jwt_decode(res.data.data.token);\n          const user = {\n            _id,\n            username,\n            token: res.data.data.token,\n            accessLevel: username === 'admin@example.com' ? 0 : 1\n          };\n          this.setState({\n            user\n          });\n          localStorage.setItem(\"user\", JSON.stringify(user));\n          alert(res.data.message);\n          this.setState({\n            visible: false\n          });\n          return true;\n        } else {\n          this.setState({\n            visible: false\n          });\n          alert(res.data.message);\n          return false;\n        }\n      } else {\n        this.setState({\n          visible: false\n        });\n        return false;\n      }\n    };\n\n    this.logout = e => {\n      e.preventDefault();\n      this.setState({\n        user: null\n      });\n      localStorage.removeItem(\"user\");\n    };\n\n    this.addProduct = (product, callback) => {\n      let products = this.state.products.slice();\n      products.push(product);\n      this.setState({\n        products\n      }, () => callback && callback());\n    };\n\n    this.addToCart = cartItem => {\n      let cart = this.state.cart;\n\n      if (cartItem.product.quantity !== 0) {\n        if (cart[cartItem.id]) {\n          cart[cartItem.id].amount += cartItem.amount;\n        } else {\n          cart[cartItem.id] = cartItem;\n        }\n\n        if (cart[cartItem.id].amount > cart[cartItem.id].product.quantity) {\n          cart[cartItem.id].amount = cart[cartItem.id].product.quantity;\n        }\n\n        localStorage.setItem(\"cart\", JSON.stringify(cart));\n        this.setState({\n          cart\n        });\n      } else {\n        alert('Product is not available');\n      }\n    };\n\n    this.removeFromCart = cartItemId => {\n      let cart = this.state.cart;\n      delete cart[cartItemId];\n      localStorage.setItem(\"cart\", JSON.stringify(cart));\n      this.setState({\n        cart\n      });\n    };\n\n    this.clearCart = () => {\n      let cart = {};\n      localStorage.removeItem(\"cart\");\n      this.setState({\n        cart,\n        visible: false\n      });\n    };\n\n    this.checkout = async () => {\n      this.setState({\n        visible: true\n      });\n\n      if (!this.state.user) {\n        this.setState({\n          visible: false\n        });\n        this.routerRef.current.history.push(\"/login\");\n        return;\n      }\n\n      const cart = this.state.cart;\n      const products = this.state.products.map(p => {\n        if (cart[p.name]) {\n          p.quantity = cart[p.name].amount;\n        }\n\n        return p;\n      });\n      const user = this.state.user;\n      const res = await axios.post(`http://localhost:5000/api/cart/checkout`, {\n        products: products,\n        user: user\n      });\n\n      if (res.status === 200) {\n        if (res.data.status === true) {\n          this.setState({\n            products: res.data.products\n          });\n          this.clearCart();\n          this.routerRef.current.history.push(\"/products\");\n          return true;\n        } else {\n          alert(res.data.message);\n          this.setState({\n            visible: false\n          });\n          return false;\n        }\n      } // const products = this.state.products.map(p => {\n      //   if (cart[p.name]) {\n      //     p.quantity = p.quantity - cart[p.name].amount;\n      //     axios.put(\n      //       `http://localhost:5000/products/${p.id}`,\n      //       { ...p },\n      //     )\n      //   }\n      //   return p;\n      // });\n\n    };\n\n    this.state = {\n      user: null,\n      cart: {},\n      visible: false,\n      products: []\n    };\n    this.routerRef = React.createRef();\n  }\n\n  async componentDidMount() {\n    let user = localStorage.getItem(\"user\");\n    let cart = localStorage.getItem(\"cart\");\n    this.setState({\n      visible: true\n    });\n    const products = await axios.get('http://localhost:5000/api/product/list-products');\n    user = user ? JSON.parse(user) : null;\n    cart = cart ? JSON.parse(cart) : {};\n    this.setState({\n      user,\n      products: products.data.products,\n      cart,\n      visible: false\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(Context.Provider, {\n      value: { ...this.state,\n        removeFromCart: this.removeFromCart,\n        addToCart: this.addToCart,\n        login: this.login,\n        register: this.register,\n        addProduct: this.addProduct,\n        clearCart: this.clearCart,\n        checkout: this.checkout\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Router, {\n      ref: this.routerRef,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        position: \"fixed\",\n        top: \"50%\",\n        left: \"50%\",\n        transform: \"translate(-50%, -50%)\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Loader, {\n      type: \"Puff\",\n      color: \"#00BFFF\",\n      height: 100,\n      width: 100,\n      visible: this.state.visible,\n      timeout: 3000,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"App\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"nav\", {\n      class: \"navbar\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"navbar-brand\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"a\", {\n      class: \"navbar-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      class: \"navbar-burger\",\n      \"data-target\": \"navbarMenuHeroB\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 21\n      }\n    })))), /*#__PURE__*/React.createElement(\"div\", {\n      className: `navbar-menu ${this.state.showMenu ? \"is-active\" : \"\"}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 237,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Link, {\n      to: \"/products\",\n      className: \"navbar-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 17\n      }\n    }, \"Products\"), this.state.user && this.state.user.accessLevel < 1 && /*#__PURE__*/React.createElement(Link, {\n      to: \"/add-product\",\n      className: \"navbar-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 19\n      }\n    }, \"Add Product\"), /*#__PURE__*/React.createElement(Link, {\n      to: \"/cart\",\n      className: \"navbar-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247,\n        columnNumber: 17\n      }\n    }, \"Cart\", /*#__PURE__*/React.createElement(\"span\", {\n      className: \"tag is-info\",\n      style: {\n        marginLeft: \"5px\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 249,\n        columnNumber: 19\n      }\n    }, Object.keys(this.state.cart).length)), !this.state.user ? /*#__PURE__*/React.createElement(Link, {\n      to: \"/login\",\n      className: \"navbar-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 19\n      }\n    }, \"Login\") : /*#__PURE__*/React.createElement(Link, {\n      to: \"/\",\n      onClick: this.logout,\n      className: \"navbar-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 19\n      }\n    }, \"Logout\"), /*#__PURE__*/React.createElement(Link, {\n      to: \"/register\",\n      className: \"navbar-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 17\n      }\n    }, \"Register\"))), /*#__PURE__*/React.createElement(Switch, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 273,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Route, {\n      exact: true,\n      path: \"/\",\n      component: ProductList,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 274,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      exact: true,\n      path: \"/login\",\n      component: Login,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 275,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      exact: true,\n      path: \"/cart\",\n      component: Cart,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 276,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      exact: true,\n      path: \"/add-product\",\n      component: AddProduct,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 277,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      exact: true,\n      path: \"/products\",\n      component: ProductList,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(Route, {\n      exact: true,\n      path: \"/register\",\n      component: Register,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 279,\n        columnNumber: 15\n      }\n    })))));\n  }\n\n}","map":{"version":3,"sources":["/Users/anjanitharayil/Documents/Development/ecommerce/frontend/src/App.js"],"names":["React","Component","Switch","Route","Link","BrowserRouter","Router","axios","jwt_decode","AddProduct","Cart","Login","ProductList","Register","Context","Loader","App","constructor","props","register","email","password","setState","visible","res","post","username","catch","status","message","data","alert","routerRef","current","history","push","login","_id","token","user","accessLevel","localStorage","setItem","JSON","stringify","logout","e","preventDefault","removeItem","addProduct","product","callback","products","state","slice","addToCart","cartItem","cart","quantity","id","amount","removeFromCart","cartItemId","clearCart","checkout","map","p","name","createRef","componentDidMount","getItem","get","parse","render","position","top","left","transform","showMenu","marginLeft","Object","keys","length"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { Switch, Route, Link, BrowserRouter as Router } from \"react-router-dom\";\nimport axios from 'axios';\nimport jwt_decode from 'jwt-decode';\n\nimport AddProduct from './components/AddProduct';\nimport Cart from './components/Cart';\nimport Login from './components/Login';\nimport ProductList from './components/ProductList';\nimport Register from './components/Register';\n\nimport Context from \"./Context\";\nimport Loader from \"react-loader-spinner\";\n\nexport default class App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      user: null,\n      cart: {},\n      visible: false,\n      products: []\n    };\n    this.routerRef = React.createRef();\n  }\n\n  async componentDidMount() {\n    let user = localStorage.getItem(\"user\");\n    let cart = localStorage.getItem(\"cart\");\n    this.setState({ visible: true });\n\n    const products = await axios.get('http://localhost:5000/api/product/list-products');\n    user = user ? JSON.parse(user) : null;\n    cart = cart ? JSON.parse(cart) : {};\n\n    this.setState({ user, products: products.data.products, cart, visible: false });\n  }\n\n  register = async (email, password) => {\n    this.setState({ visible: true });\n\n    const res = await axios.post(\n      'http://localhost:5000/api/user/signup',\n      { username: email, password: password },\n    ).catch((res) => {\n      this.setState({ visible: false });\n      return { status: 401, message: 'Unauthorized' }\n    })\n    if (res.status === 200) {\n      this.setState({ visible: false });\n      if (res.data.status === true) {\n        alert(res.data.message)\n        this.routerRef.current.history.push(\"/login\");\n\n        return true;\n      } else {\n        alert(res.data.message)\n        return false;\n      }\n    }\n    else {\n      this.setState({ visible: false });\n      return false;\n    }\n\n  }\n\n  login = async (email, password) => {\n    this.setState({ visible: true });\n    const res = await axios.post(\n      'http://localhost:5000/api/user/login',\n      { username: email, password: password },\n    ).catch((res) => {\n      this.setState({ visible: false });\n      return { status: 401, message: 'Unauthorized' }\n    })\n\n    if (res.status === 200) {\n      if (res.data.status === true) {\n        // console.log(jwt_decode(res.data.data.token))\n        const { username, _id } = jwt_decode(res.data.data.token)\n        const user = {\n          _id,\n          username,\n          token: res.data.data.token,\n          accessLevel: username === 'admin@example.com' ? 0 : 1\n        }\n\n        this.setState({ user });\n        localStorage.setItem(\"user\", JSON.stringify(user));\n        alert(res.data.message)\n        this.setState({ visible: false });\n        return true;\n      } else {\n        this.setState({ visible: false });\n        alert(res.data.message)\n        return false;\n      }\n    } else {\n      this.setState({ visible: false });\n      return false;\n    }\n  }\n\n  logout = e => {\n    e.preventDefault();\n    this.setState({ user: null });\n    localStorage.removeItem(\"user\");\n  };\n\n  addProduct = (product, callback) => {\n    let products = this.state.products.slice();\n    products.push(product);\n    this.setState({ products }, () => callback && callback());\n  };\n\n  addToCart = cartItem => {\n    let cart = this.state.cart;\n    if (cartItem.product.quantity !== 0) {\n      if (cart[cartItem.id]) {\n        cart[cartItem.id].amount += cartItem.amount;\n      } else {\n        cart[cartItem.id] = cartItem;\n      }\n      if (cart[cartItem.id].amount > cart[cartItem.id].product.quantity) {\n        cart[cartItem.id].amount = cart[cartItem.id].product.quantity;\n      }\n      localStorage.setItem(\"cart\", JSON.stringify(cart));\n      this.setState({ cart });\n    }\n    else {\n      alert('Product is not available')\n    }\n\n  };\n\n  removeFromCart = cartItemId => {\n    let cart = this.state.cart;\n    delete cart[cartItemId];\n    localStorage.setItem(\"cart\", JSON.stringify(cart));\n    this.setState({ cart });\n  };\n\n  clearCart = () => {\n    let cart = {};\n    localStorage.removeItem(\"cart\");\n    this.setState({ cart, visible: false });\n  };\n\n  checkout = async () => {\n    this.setState({ visible: true });\n    if (!this.state.user) {\n      this.setState({ visible: false });\n      this.routerRef.current.history.push(\"/login\");\n      return;\n    }\n    const cart = this.state.cart;\n\n    const products = this.state.products.map(p => {\n      if (cart[p.name]) {\n        p.quantity = cart[p.name].amount;\n      }\n      return p;\n    });\n    const user = this.state.user;\n    const res = await axios.post(\n      `http://localhost:5000/api/cart/checkout`,\n      { products: products, user: user },\n    )\n    if (res.status === 200) {\n      if (res.data.status === true) {\n        this.setState({ products: res.data.products });\n        this.clearCart();\n        this.routerRef.current.history.push(\"/products\");\n        return true;\n      } else {\n        alert(res.data.message)\n        this.setState({ visible: false });\n        return false;\n      }\n    }\n\n    // const products = this.state.products.map(p => {\n    //   if (cart[p.name]) {\n    //     p.quantity = p.quantity - cart[p.name].amount;\n\n    //     axios.put(\n    //       `http://localhost:5000/products/${p.id}`,\n    //       { ...p },\n    //     )\n    //   }\n    //   return p;\n    // });\n\n\n  };\n\n  render() {\n    return (\n      <Context.Provider\n        value={{\n          ...this.state,\n          removeFromCart: this.removeFromCart,\n          addToCart: this.addToCart,\n          login: this.login,\n          register: this.register,\n          addProduct: this.addProduct,\n          clearCart: this.clearCart,\n          checkout: this.checkout\n        }}\n      >\n        <Router ref={this.routerRef}>\n          <div style={{ position: \"fixed\", top: \"50%\", left: \"50%\", transform: \"translate(-50%, -50%)\" }}>\n            <Loader\n              type=\"Puff\"\n              color=\"#00BFFF\"\n              height={100}\n              width={100}\n              visible={this.state.visible}\n              timeout={3000}\n            />\n          </div>\n          <div className=\"App\">\n            <nav class=\"navbar\">\n              <div class=\"container\">\n                <div class=\"navbar-brand\">\n                  <a class=\"navbar-item\">\n                  </a>\n                  <span class=\"navbar-burger\" data-target=\"navbarMenuHeroB\">\n                    <span></span>\n                    <span></span>\n                    <span></span>\n                  </span>\n                </div>\n\n              </div>\n              <div className={`navbar-menu ${this.state.showMenu ? \"is-active\" : \"\"\n                }`}>\n                <Link to=\"/products\" className=\"navbar-item\">\n                  Products\n                </Link>\n                {this.state.user && this.state.user.accessLevel < 1 && (\n                  <Link to=\"/add-product\" className=\"navbar-item\">\n                    Add Product\n                  </Link>\n                )}\n                <Link to=\"/cart\" className=\"navbar-item\">\n                  Cart\n                  <span\n                    className=\"tag is-info\"\n                    style={{ marginLeft: \"5px\" }}\n                  >\n                    {Object.keys(this.state.cart).length}\n                  </span>\n                </Link>\n\n                {!this.state.user ? (\n                  <Link to=\"/login\" className=\"navbar-item\">\n                    Login\n                  </Link>\n\n                ) : (\n                  <Link to=\"/\" onClick={this.logout} className=\"navbar-item\">\n                    Logout\n                  </Link>\n                )}\n                <Link to=\"/register\" className=\"navbar-item\">\n                  Register\n                  </Link>\n              </div>\n            </nav>\n\n            <Switch>\n              <Route exact path=\"/\" component={ProductList} />\n              <Route exact path=\"/login\" component={Login} />\n              <Route exact path=\"/cart\" component={Cart} />\n              <Route exact path=\"/add-product\" component={AddProduct} />\n              <Route exact path=\"/products\" component={ProductList} />\n              <Route exact path=\"/register\" component={Register} />\n\n            </Switch>\n          </div>\n        </Router >\n      </Context.Provider >\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}